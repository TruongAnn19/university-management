<div class="reg-container">
  <div class="header-box">
    <h2>ğŸ“ ÄÄƒng kÃ½ TÃ­n chá»‰</h2>
    <p class="sub-text">Há»c ká»³ hiá»‡n táº¡i Ä‘ang má»Ÿ Ä‘Äƒng kÃ½. Vui lÃ²ng chá»n lá»›p cáº©n tháº­n.</p>
  </div>

  <div class="filter-card">
    <div class="filter-group">
      <label for="facultySelect">Lá»c theo Khoa/Viá»‡n:</label>
      <select id="facultySelect" [(ngModel)]="selectedFacultyId" (change)="onFacultyChange()" class="form-select"
        [disabled]="isLoading">

        <option [ngValue]="null">-- Táº¥t cáº£ / MÃ´n dÃ¹ng chung --</option>

        <option *ngFor="let f of faculties" [value]="f.id">
          {{ f.facultyName }}
        </option>
      </select>
    </div>
    <div class="loading-spinner" *ngIf="isLoading"></div>
  </div>

  <div *ngIf="message" class="alert" [ngClass]="isError ? 'alert-danger' : 'alert-success'">
    {{ message }}
  </div>

  <div class="table-responsive">
    <table class="custom-table">
      <thead>
        <tr>
          <th>MÃ£ Lá»›p</th>
          <th>TÃªn MÃ´n Há»c</th>
          <th>Khoa Quáº£n LÃ½</th>
          <th>Thá»i Gian Há»c</th>
          <th class="text-center">Sá»‘ TC</th>
          <th class="text-center">SÄ© Sá»‘</th>
          <th class="text-center">Tráº¡ng ThÃ¡i</th>
          <th class="text-center">HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of classes" [class.row-registered]="c.isRegistered">
          <td class="class-code">{{ c.classCode }}</td>
          <td class="subject-name">{{ c.subjectName }}</td>
          <td>
            <span class="badge faculty-badge">{{ c.facultyName || 'Äáº¡i CÆ°Æ¡ng' }}</span>
          </td>
          <td>
            <div class="time-box">
              <small class="semester-name">{{ c.semesterName }}</small>
              <div class="date-range">
                {{ c.startDate | date:'dd/MM/yyyy' }} - {{ c.endDate | date:'dd/MM/yyyy' }}
              </div>
            </div>
          </td>
          <td class="text-center bold">{{ c.credits }}</td>

          <td class="text-center">
            <span [class.text-danger]="!c.isRegistered && c.currentSlot >= c.maxSlot">
              {{ c.currentSlot }} / {{ c.maxSlot }}
            </span>
          </td>

          <td class="text-center">

            <span *ngIf="c.isMyClass" class="badge status-learning">
              ğŸ“š Äang há»c
            </span>

            <span *ngIf="!c.isMyClass && c.timeStatus === 'EXPIRED'" class="badge status-closed">
              Háº¿t háº¡n ÄK
            </span>

            <span *ngIf="!c.isMyClass && c.timeStatus === 'WAITING'" class="badge status-waiting">
              Sáº¯p má»Ÿ
            </span>

            <span *ngIf="!c.isMyClass && c.timeStatus === 'OPEN' && c.currentSlot >= c.maxSlot"
              class="badge status-full">
              Lá»›p Ä‘áº§y
            </span>

            <span *ngIf="!c.isMyClass && c.isRegistered" class="badge status-retake">
              TrÃ¹ng mÃ´n
            </span>

            <span *ngIf="!c.isRegistered && c.studyStatus === 'PASSED'" class="badge status-passed">ÄÃ£ qua</span>
            <span *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.currentSlot >= c.maxSlot"
              class="badge status-full">Háº¿t chá»—</span>
            <span *ngIf="!c.isRegistered && !c.isMyClass && c.currentSlot < c.maxSlot && c.timeStatus === 'OPEN'"
              class="badge status-open">Cho
              phÃ©p ÄK</span>

          </td>

          <td class="text-center">

            <button *ngIf="c.isMyClass" class="btn-cancel" (click)="onCancel(c.classCode)" [disabled]="isLoading">
              Há»§y
            </button>

            <button *ngIf="!c.isMyClass && c.isRegistered" class="btn-disabled" disabled
              title="Báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ mÃ´n nÃ y á»Ÿ lá»›p khÃ¡c">
              ÄÃ£ ÄK
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'OPEN'"
              class="btn-register" (click)="onRegister(c.classCode)"
              [disabled]="c.currentSlot >= c.maxSlot || isLoading"> {{ c.currentSlot >= c.maxSlot ? 'Háº¿t chá»—' : 'ÄÄƒng
              kÃ½' }}
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'WAITING'"
              class="btn-disabled" disabled>
              ÄÄƒng kÃ½
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'EXPIRED'"
              class="btn-disabled" disabled>
              ÄÄƒng kÃ½
            </button>

          </td>
        </tr>
        <tr *ngIf="classes.length === 0 && !isLoading">
          <td colspan="7" class="empty-row">KhÃ´ng tÃ¬m tháº¥y lá»›p há»c pháº§n nÃ o.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>