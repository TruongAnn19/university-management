<div class="reg-container">
  <div class="header-box">
    <h2>üìù ƒêƒÉng k√Ω T√≠n ch·ªâ</h2>
    <p class="sub-text">H·ªçc k·ª≥ hi·ªán t·∫°i ƒëang m·ªü ƒëƒÉng k√Ω. Vui l√≤ng ch·ªçn l·ªõp c·∫©n th·∫≠n.</p>
  </div>

  <div class="filter-card">
    <div class="filter-group">
      <label for="facultySelect">L·ªçc theo Khoa/Vi·ªán:</label>
      <select id="facultySelect" [(ngModel)]="selectedFacultyId" (change)="onFacultyChange()" class="form-select"
        [disabled]="isLoading">

        <option [ngValue]="null">-- T·∫•t c·∫£ / M√¥n d√πng chung --</option>

        <option *ngFor="let f of faculties" [value]="f.id">
          {{ f.facultyName }}
        </option>
      </select>
    </div>
    <div class="loading-spinner" *ngIf="isLoading"></div>
  </div>

  <div *ngIf="message" class="alert" [ngClass]="isError ? 'alert-danger' : 'alert-success'">
    {{ message }}
  </div>

  <div class="table-responsive">
    <table class="custom-table">
      <thead>
        <tr>
          <th>M√£ L·ªõp</th>
          <th>T√™n M√¥n H·ªçc</th>
          <th>Khoa Qu·∫£n L√Ω</th>
          <th>Th·ªùi Gian H·ªçc</th>
          <th class="text-center">S·ªë TC</th>
          <th class="text-center">Sƒ© S·ªë</th>
          <th class="text-center">Tr·∫°ng Th√°i</th>
          <th class="text-center">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of classes" [class.row-registered]="c.isRegistered">
          <td class="class-code">{{ c.classCode }}</td>
          <td class="subject-name">{{ c.subjectName }}</td>
          <td>
            <span class="badge faculty-badge">{{ c.facultyName || 'ƒê·∫°i C∆∞∆°ng' }}</span>
          </td>
          <td>
            <div class="time-box">
              <small class="semester-name">{{ c.semesterName }}</small>
              <div class="date-range">
                {{ c.startDate | date:'dd/MM/yyyy' }} - {{ c.endDate | date:'dd/MM/yyyy' }}
              </div>
            </div>
          </td>
          <td class="text-center bold">{{ c.credits }}</td>

          <td class="text-center">
            <span [class.text-danger]="!c.isRegistered && c.currentSlot >= c.maxSlot">
              {{ c.currentSlot }} / {{ c.maxSlot }}
            </span>
          </td>

          <td class="text-center">
            <ng-container *ngIf="getCourseStatus(c) as status">
              <span class="badge" [ngClass]="status.class">
                {{ status.text }}
              </span>
            </ng-container>
          </td>

          <td class="text-center">

            <button *ngIf="c.isMyClass" class="btn-cancel" (click)="onCancel(c.classCode)" [disabled]="isLoading">
              H·ªßy
            </button>

            <button *ngIf="!c.isMyClass && c.isRegistered" class="btn-disabled" disabled
              title="B·∫°n ƒë√£ ƒëƒÉng k√Ω m√¥n n√†y ·ªü l·ªõp kh√°c">
              ƒê√£ ƒêK
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'OPEN'"
              class="btn-register" (click)="onRegister(c.classCode)"
              [disabled]="c.currentSlot >= c.maxSlot || isLoading"> {{ c.currentSlot >= c.maxSlot ? 'H·∫øt ch·ªó' : 'ƒêƒÉng
              k√Ω' }}
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'WAITING'"
              class="btn-disabled" disabled>
              ƒêƒÉng k√Ω
            </button>

            <button *ngIf="!c.isRegistered && c.studyStatus !== 'PASSED' && c.timeStatus === 'EXPIRED'"
              class="btn-disabled" disabled>
              ƒêƒÉng k√Ω
            </button>

          </td>
        </tr>
        <tr *ngIf="classes.length === 0 && !isLoading">
          <td colspan="7" class="empty-row">Kh√¥ng t√¨m th·∫•y l·ªõp h·ªçc ph·∫ßn n√†o.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>